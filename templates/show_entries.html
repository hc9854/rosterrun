{% extends "layout.html" %}
{% block body %}
  {% if session.logged_in %}
    <form action="{{ url_for('show_entries') }}" method=post class=run-calculation>
      <h2>Guild Dashboard</h2>
      <table class="guild dashboard">
        <tr>
        <td><a href="{{ url_for('show_entries') }}">Roster</a></td>
        <td><a href="{{ url_for('market_results') }}">Market Results</a></td>
        <td><a href="{{ url_for('treasury') }}">Treasury</a></td>
        <td><a href="{{ url_for('points') }}">Points</a></td>
      </table>
      <dl>
        <dt>Google Document:
        <dd><input type=text name=gdocname placeholder="Quest Status">
        <dd><input type=submit name=action value=Import>
        <input type=submit name=action value=Calculate>
        <input type=submit name=action value=Refresh>
        <input type=submit name=action value=Reset>
      </dl>
    </form>
    <h2>Character Status</h2>
    <table action="{{ url_for('update_chars') }}" method=post class=character>
    <tr>
    <th>Manage</th>
    <th>Class</th>
    <th>Name</th>
    <th>Role</th>
    <th>Last Run</th>
    <th>Player Name</th>
    <th>Online?</th>
    </tr>
    {% for char in characters %}
      <tr>
      <td><input type=submit name=action value=Drop><input type=submit name=action value=Edit>
      <td><h2>{{ char.Class|safe }}</h2></td>
      <td>{{ char.Name|safe }}</td>
      <td>{{ char.Role|safe}}</td>
      <td>{{ char.LastRun|safe }}</td>
      <td>{{ char.PlayerName|safe }}</td>
      <td>{{ char.Present|safe }}</td>
    {% endfor %}
    </table>
    <form action="{{ url_for('add_character') }}" method=post>
      <h2>Character</h2>
      <dd>Class: <input type=text name=charclass placeholder="High Wizard">
      <dd>Name: <input type=text name=charname placeholder="Billdalf">
      <dd>Quests: <input type=text name=charquests placeholder="twotribes">
      <dd>Last Run: <input type=text name=charlastrun placeholder="2/9/2014">
      <dd>Player Name: <input type=text name=charplayername placeholder="Billy">
      <dd>Present: <input type=text name=charpresent placeholder="1">
      <input type=submit name=action value=Add></>
    </form>
    <h2>Party Combinations</h2>
    <table class=combination>
    {% for group in marketresults|groupby('InstanceName') %}
	  <tr><td colspan="6"><h2>{{ group.grouper|safe }}</h2></td></tr>
	  {% for mr in group.list %}
	    <tr>
	    <th>Player Name</th>
	    <th>Character Name</th>
		<th>Class</th>
		<th>Role</th>
        </tr>
		<td>{{ mr.PlayerName)|safe }}</td>
		<td>{{ mr.CharacterName|safe }}</td>
		<td>{{ mr.CharacterClass|safe }}</td>
		<td>{{ mr.RoleName|safe }}</td>
	  {% endfor %}
    {% endfor %}
    </table>
  {% endif %}
{% endblock %}